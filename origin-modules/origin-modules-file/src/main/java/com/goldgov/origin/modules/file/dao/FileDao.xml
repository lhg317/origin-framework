<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.goldgov.origin.modules.file.dao.FileDao">

	<resultMap type="com.goldgov.origin.modules.file.service.File" id="file">
		<id column="FILE_ID" jdbcType="INTEGER" property="fileID"/>
		<result column="FILE_NAME" jdbcType="VARCHAR" property="fileName"/>
		<result column="FILE_TYPE" jdbcType="VARCHAR" property="fileType"/>
		<result column="FILE_SIZE" jdbcType="INTEGER" property="fileSize"/>
		<result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate"/>
		<result column="RELATION_ID" jdbcType="VARCHAR" property="relationID"/>
	</resultMap>

	<sql id="fileFields">
		FILE_ID as "fileID",
		FILE_NAME as "fileName",
		FILE_TYPE as "fileType",
		FILE_SIZE as "fileSize",
		CREATE_DATE as "createDate",
		RELATION_ID as "relationID"
	</sql>
	
	<insert id="addFile">
		<selectKey keyProperty="fileID" resultType="String" order="BEFORE">
		    select uuid() from dual
		</selectKey>
		insert into FILE_STORAGE (FILE_ID,FILE_NAME,FILE_TYPE,FILE_SIZE,CREATE_DATE,RELATION_ID)
		value(#{fileID},#{fileName},#{fileType},#{fileSize},#{createDate},#{relationID});
	</insert>
	
	<delete id="deleteFile">
		delete from FILE_STORAGE where FILE_ID IN
		<foreach item="id" index="index" collection="ids" open="(" separator="," close=")">
		   #{id}
		</foreach>
	</delete>
	
	<select id="getFile" resultMap="file">
		SELECT <include refid="fileFields" /> FROM FILE_STORAGE WHERE FILE_ID=#{fileID}
	</select>
	
	<select id="listFile" resultMap="file">
		SELECT <include refid="fileFields" /> FROM FILE_STORAGE WHERE RELATION_ID=#{relationID}
	</select>
	
	<update id="upldateRelationID" >
		UPDATE FILE_STORAGE SET RELATION_ID = #{relationID} WHERE FILE_ID IN
		<foreach item="id" index="index" collection="ids" open="(" separator="," close=")">
		   #{id}
		</foreach>
	</update>
	
</mapper>